---
import { PluginInlineFragment } from './graphql';
import { readFragment, type FragmentOf } from 'gql.tada';
import { buildUrlForPlugin } from '~/lib/datocms/gqlUrlBuilder/plugin';
import s from './style.module.css';
import { stripStega } from '@datocms/astro';

interface Props {
  record: FragmentOf<typeof PluginInlineFragment>;
}

const { record } = Astro.props;

const unmaskedRecord = readFragment(PluginInlineFragment, record);
---

<a
  href={buildUrlForPlugin(unmaskedRecord)}
  class={s.root}
  data-datocms-content-link-source={unmaskedRecord.title}
  data-datocms-content-link-boundary
  >{unmaskedRecord.coverImage && <img loading="lazy" src={unmaskedRecord.coverImage.url} />}<span
    >{stripStega(unmaskedRecord.title)}</span
  ></a
>
