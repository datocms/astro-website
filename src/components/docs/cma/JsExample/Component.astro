---
import { EndpointExample } from '~/components/docs/cma/EndpointExample';
import type { CmaEndpoint, CmaEndpointJsExample, CmaEntity } from '../types';
import { buildApiCallSampleCode, buildApiCallReturnValue } from './buildJs';
import type { RestClientEndpointInfo } from '../fetchRestClientEndpointInfo';

type Props = {
  id: string;
  entity: CmaEntity;
  endpoint: CmaEndpoint;
  restClientEndpointInfo: RestClientEndpointInfo;
  example?: CmaEndpointJsExample;
  startVisible?: boolean;
};

const { id, example, endpoint, entity, restClientEndpointInfo, startVisible } = Astro.props;

const sampleCode =
  example?.request?.code ||
  (await buildApiCallSampleCode(entity, endpoint, restClientEndpointInfo));

const output =
  example?.response?.code || (await buildApiCallReturnValue(endpoint, restClientEndpointInfo));
---

<EndpointExample
  id={id}
  startVisible={startVisible}
  title={example?.title || 'Basic example'}
  description={example?.description}
  tabs={[
    {
      title: 'Code',
      description: example?.request?.description,
      language: 'javascript',
      code: sampleCode,
    },
    ...(output
      ? [
          {
            title: 'Returned output',
            description: example?.response?.description,
            language: 'javascript',
            code: output,
          },
        ]
      : []),
  ]}
/>
