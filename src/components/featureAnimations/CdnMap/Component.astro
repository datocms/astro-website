---
import ky from 'ky';
import { FASTLY_KEY } from 'astro:env/server';
import CdnMap from './ReactComponent';
import { Svg } from '~/components/Svg';

type DataCenter = {
  code: string;
  name: string;
  group: string;
  region: string;
  stats_region: string;
  billing_region: string;
  coordinates: { x: number; y: number; latitude: number; longitude: number };
  shield: string;
};

const datacenters = await ky<DataCenter[]>('https://api.fastly.com/datacenters', {
  headers: {
    'Fastly-Key': FASTLY_KEY,
  },
}).json();
---

<CdnMap datacenters={datacenters} client:load>
  <Svg name="svg/world" />
</CdnMap>
