---
import { DraftModeQueryListener } from '~/components/DraftModeQueryListener';
import { PageLayout, findGroupAndPage } from '~/layouts/docs/PageLayout';
import { notFoundResponse } from '~/lib/notFoundResponse';
import { buildSidebarItems } from './_buildSidebarItems';

const result = await findGroupAndPage(Astro, 'content-management-api');

if (!result) {
  return notFoundResponse();
}

const [group, page, queryListenerProps] = result;

const sidebarItems = await buildSidebarItems();
---

<PageLayout page={page} group={group} additionalSidebarItems={sidebarItems} />

{queryListenerProps.map((props) => <DraftModeQueryListener {...props} />)}
