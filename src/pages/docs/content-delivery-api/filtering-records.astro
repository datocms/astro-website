---
import { fetchIntrospectionFieldFilters, fieldTypeName } from './_utils';
import Page from '../[...rest]/index.astro';
import { Heading } from '~/components/Heading';
import Filters from './_Filters.astro';
import { slugify } from '~/lib/slugify';
import { camelize } from './_gqlExample';

const response = await fetchIntrospectionFieldFilters();
---

<Page
  rest="content-delivery-api/filtering-records"
  additionalTocGroups={[
    {
      title: 'Filters available for field types',
      entries: Object.keys(response.field_types).map((fieldName) => ({
        label: fieldTypeName[fieldName]!,
        url: `#${slugify(fieldName)}`,
      })),
    },
    {
      title: 'Filters available for meta fields',
      entries: Object.keys(response.meta).map((fieldName) => ({
        label: camelize(fieldName),
        url: `#${slugify(camelize(fieldName))}`,
      })),
    },
  ]}
>
  <Heading anchor="field-types" as="h2">Filters available for field types</Heading>
  {
    Object.entries(response.field_types).map(([fieldName, filters]) => (
      <>
        <Heading anchor={slugify(fieldName)} as="h4">
          {fieldTypeName[fieldName]} fields
        </Heading>
        <Filters fieldName={fieldName} filters={filters} />
      </>
    ))
  }
  <Heading anchor="meta-fields" as="h3">Filters available for meta fields</Heading>
  {
    Object.entries(response.meta).map(([fieldName, filters]) => (
      <>
        <Heading anchor={slugify(camelize(fieldName))} as="h4">
          Filter by <code>{camelize(fieldName)}</code> meta field
        </Heading>
        <Filters fieldName={fieldName} filters={filters} />
      </>
    ))
  }
</Page>
