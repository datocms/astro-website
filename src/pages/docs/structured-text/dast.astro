---
import { fetchDastNodes } from '~/components/docs/blocks/DastSchema/utils';
import Page from '../[...rest]/index.astro';
import { Heading } from '~/components/Heading';
import { Markdown } from '@astropub/md';
import { Code } from '~/components/Code';
import { intersperse } from '~/lib/intersperse';

const nodes = await fetchDastNodes();
---

<Page
  rest="structured-text/dast"
  additionalTocGroups={[
    {
      title: 'Nodes',
      entries: nodes.map((node) => ({ label: node.name, url: `#${node.name}` })),
    },
  ]}
>
  {
    nodes.map((node) => {
      const childrenNodes = node.childrenNodes.map((subNode) =>
        // prettier-ignore
        <a href={`#${subNode}`}><code>{subNode}</code></a>,
      );

      return (
        <>
          <Heading anchor={node.name} as="h3">
            <code>{node.name}</code>
          </Heading>
          <Markdown of={node.description} />
          <p>
            {node.childrenNodes.length > 0 ? (
              <>
                It allows the following children nodes: {intersperse(childrenNodes, ', ', ' and ')}.
              </>
            ) : (
              <>It does not allow children nodes.</>
            )}
          </p>
          {/* <JsonSchemaObject key={name} name={name} schema={definition} level={1} /> */}
          {node.example && <Code code={node.example.code} language={node.example.language} />}
        </>
      );
    })
  }
</Page>
