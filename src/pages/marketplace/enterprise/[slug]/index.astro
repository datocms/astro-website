---
import Wrapper from '~/components/Wrapper/ReactComponent';
import { Button } from '~/components/Button';
import { Image } from '~/components/blocks/Image';
import { InternalVideo } from '~/components/blocks/InternalVideo';
import { Layout } from '~/layouts/Layout';
import { MarketplaceCard } from '~/components/MarketplaceCard';
import { Prose } from '~/components/Prose';
import { Space } from '~/components/Space';
import { Text } from '~/components/structuredText/Text';
import { Video } from '~/components/blocks/Video';
import { executeQuery } from '~/lib/datocms/executeQuery';
import { notFoundResponse, avoidAstroTypeCheckBug } from '~/lib/notFoundResponse';
import { withAllComponents } from '~/lib/datocms/structuredText';
import { query } from './_graphql';
import s from './_style.module.css';

const { slug } = Astro.params;
const variables = { slug: slug! };
const { page } = await executeQuery(Astro, query, { variables });

if (!page) {
  avoidAstroTypeCheckBug(notFoundResponse);
  return notFoundResponse();
}
---

<Layout noFinalCta additionalSeo={[]}>
  <Fragment slot="head">
    <title>Enterprise apps - Marketplace</title>
  </Fragment>

  <Space top={2}>
    <Wrapper>
      <div class={s.grid}>
        <div class={s.content}>
          <h1 class={s.title}>{page.title}</h1>
          <h3 class={s.subtitle}>{page.description}</h3>
          <Space top={2}>
            <Prose>
              <Text
                data={page.content}
                blockComponents={withAllComponents(page.content.blocks, {
                  ImageRecord: Image,
                  InternalVideoRecord: InternalVideo,
                  VideoRecord: Video,
                })}
              />
            </Prose>
          </Space>
        </div>

        <aside class={s.aside}>
          <div class={s.asideContent}>
            <MarketplaceCard title={page.title} background="azure" svgLogoUrl={page.logo.url}>
              {page.shortDescription}
              <Fragment slot="below">
                <Button as="a" href="/contact" target="_blank" fs="small" p="small">
                  Request activation
                </Button>
              </Fragment>
            </MarketplaceCard>
          </div>
        </aside>
      </div>
    </Wrapper>
  </Space>
</Layout>
