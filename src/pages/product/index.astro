---
import { executeQuery } from '~/lib/datocms/executeQuery';
import Layout from '~/layouts/Layout.astro';
import s from './_style.module.css';
import { Hero } from '~/components/Hero';
import { Button } from '~/components/Button';
import { Bullets } from '~/components/Bullets';
import { Flag } from '~/components/Flag';
import { ResponsiveImage } from '~/components/ResponsiveImage';
import { notFoundResponse } from '~/lib/notFoundResponse';
import { DraftModeQueryListener } from '~/components/DraftModeQueryListener';
import { Wrapper } from '~/components/Wrapper';
import { query } from './_graphql';
import { IntegrationsBanner } from '~/components/IntegrationsBanner';
import { HighlightStructuredText } from '~/components/HighlightStructuredText';

const { integrations, page } = await executeQuery(Astro, query);

if (!page) {
  return notFoundResponse();
}
---

<Layout>
  <Wrapper>
    <Hero
      title="The Headless CMS that gets out of the way"
      subtitle="DatoCMS is about giving you the tools to do what you need, without the fuss. It's straightforward, it's reliable, and it lets you deliver digital projects fast, with confidence."
    >
      <div class={s.buttonContainer}>
        <Button fs="big" as="a" href="https://dashboard.datocms.com/signup">Try it for free</Button>
        <Button fs="big" as="a" s="invert" href="/contact">Contact sales</Button>
      </div>
    </Hero>
  </Wrapper>

  {
    page.pillars.map((pillar, index) => {
      return (
        <div class={s.flagContainer}>
          <Flag kicker={pillar.theme} flip={index % 2 === 0} style="bad" hideDot>
            <div slot="visual">
              {/* @ts-ignore */}
              <ResponsiveImage data={pillar.image.responsiveImage} />
            </div>
            <div slot="title">
              <HighlightStructuredText data={pillar.title} />
            </div>
            <article>
              {pillar.pillarCallout}
              <Bullets
                items={[pillar.capability1, pillar.capability2, pillar.capability3]}
                icon={'regular/check'}
                style="bad"
              />
            </article>
          </Flag>
        </div>
      );
    })
  }

  <IntegrationsBanner
    title="Extensible and integrable by design"
    bubbles={integrations
      .filter((i) =>
        ['ci', 'static-generator', 'language', 'cdn', 'framework'].includes(
          i.integrationType.slug as string,
        ),
      )
      .slice(0, 30)
      .map((integration) =>
        integration.squareLogo ? integration.squareLogo.url : integration.logo.url,
      )}
  >
    <p>
      Being a API-first <a href="/">headless CMS</a>, <strong>
        DatoCMS easily integrates with any third-party platform or service
      </strong>. DatoCMS is considered to be the best CMS for developers because it offers some of
      the best tools in the market: plugins, webhooks, templates and SDKs to get you started in no
      time. Check them out on our <a
        href="https://github.com/datocms/"
        target="_blank"
        rel="noreferrer"
      >
        official Github page
      </a>
    </p>
  </IntegrationsBanner>

  <DraftModeQueryListener query={query} />
</Layout>
