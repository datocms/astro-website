---
import Group from './Group.astro';
import GroupItem from './GroupItem.astro';
import NavItem from './NavItem.astro';
import PanelHighlight from './PanelHighlight.astro';
import PanelSlice from './PanelSlice.astro';
import { Button } from '~/components/Button';
import { Svg } from '~/components/Svg';
import { TargetToggler } from '~/components/TargetToggler';
import { Wrapper } from '~/components/Wrapper';
import s from './style.module.css';

const isMarketplace = Astro.url.pathname.startsWith('/marketplace');
---

<site-navbar>
  <div class={s.root} data-datocms-noindex>
    {
      false && !isMarketplace && (
        <a href="/webinars/how-to-use-structured-text-on-datocms" data-notice class={s.notice}>
          <Wrapper>
            <strong>ðŸ“… Want to learn how to use our new Structured Text field with Next.js?</strong>{' '}
            Follow our webinar on Wednesday,{' '}
            {new Date('2021-03-10T18:00:00+01:00').toLocaleTimeString('en-US', {
              hour: 'numeric',
              minute: '2-digit',
              timeZoneName: 'short',
            })}
          </Wrapper>
        </a>
      )
    }

    {
      isMarketplace && (
        <div data-marketplace-notice class={s.marketplaceNotice}>
          <Wrapper>
            <strong>ðŸŽˆ Welcome to the Marketplace</strong> â€” Explore and discover the ecosystem
            around DatoCMS, and share your own work with the community!
          </Wrapper>
        </div>
      )
    }

    <nav class={s.nav} id="navbar-nav">
      <div class={s.logoWrapper}>
        <a href="/" class={s.logo}>
          <Svg name="svg/datocms/icon-text/color/color_full_logo_alt" />
        </a>

        <TargetToggler targetId="navbar-nav">
          <button type="button" class={s.hamburger} aria-controls="navList">
            <Svg name="icons/regular/bars" />
          </button>
        </TargetToggler>
      </div>

      <div class={s.navList}>
        <NavItem name="Product">
          <PanelHighlight>
            <Group title="Platform">
              <GroupItem
                href="/product"
                title="Meet DatoCMS!"
                description="Explore all the capabilities of the friendliest Headless CMS in town."
              />
              <GroupItem
                href="/product-updates"
                title="See whatâ€™s new"
                description="Check out the latest releases and updates on our changelog."
              />
            </Group>
            <div class={s.ctaBox} data-exclude-mobile>
              <div class={s.ctaBoxShape}>
                <div class={s.ctaImageWrapper}>
                  <div class={s.ctaImage}>
                    <Svg name="svg/illustrations/box-things" />
                  </div>
                </div>
                <article class={s.ctaBody}>
                  <h3 class={s.ctaTitle}>Try DatoCMS for Free</h3>
                  <p class={s.ctaDescription}>
                    Try a no-strings-attached demo. No signup. No email. No credit card.
                  </p>
                </article>
                <Button
                  class={s.ctaButton}
                  as="a"
                  p="tiny"
                  href="https://try.datocms.com/"
                  target="_blank"
                >
                  Launch interactive demo
                </Button>
              </div>
            </div>
          </PanelHighlight>
          <PanelSlice columns={2}>
            <Group columns={2} title="Features" link="/features">
              <GroupItem
                href="/features/headless-cms-graphql"
                title="GraphQL API"
                description="See why Headless CMS and GraphQL APIs are a match made in heaven."
              />
              <GroupItem
                href="/features/structured-content-cms"
                title="Structured text"
                description="Meet (arguably) the best headless content editor out there."
              />
              <GroupItem
                href="/features/headless-cms-multi-language"
                title="Localization"
                description="With i18n out of the box, meet your customers wherever they are."
              />
              <GroupItem
                href="/features/dynamic-layouts"
                title="Modular Content"
                description="Check out the dynamic page building experience youâ€™ll fall in love with."
              />
            </Group>
            <Group title="Use cases">
              <GroupItem
                href="/use-cases/headless-cms-websites"
                title="Modern Websites"
                description="Build bold with SEO, Assets, Live Previews, and more, out of the box."
              />
              <GroupItem
                href="/use-cases/headless-ecommerce"
                title="eCommerce"
                description="Manage content and commerce experiences that fly off the shelf!"
              />
              <GroupItem
                href="/use-cases/headless-cms-publishing"
                title="Digital Publishing"
                description="Ship content at scale with blazing fast speeds (or in real time)."
              />
              <GroupItem
                href="/use-cases/headless-cms-knowledge-management"
                title="Knowledge Management"
                description="Simplify complex content for portals, wikis, intranets, and more."
              />
            </Group>
            <Group title="Happy Teams">
              <GroupItem
                href="/team/best-cms-for-developers"
                title="For Web Developers"
                description="Stop settling for legacy web technologies that slow you down."
              />
              <GroupItem
                href="/team/cms-digital-marketing"
                title="For Digital Marketers"
                description="Take control of your content with a unified platform for all channels."
              />
              <GroupItem
                href="/team/content-creators"
                title="For Content Creators"
                description="Aggreggate all your content in one place and go live in seconds"
              />
              <GroupItem
                href="/enterprise-headless-cms"
                title="For Enterprise"
                description="Join 25K+ teams, from governments to the F500, in trusting DatoCMS."
              />
            </Group>
          </PanelSlice>
        </NavItem>

        <NavItem name="Customers">
          <PanelHighlight>
            <Group title="DatoCMS in production">
              <GroupItem
                href="/success-stories"
                title="DatoCMS Success Stories"
                description="See how DatoCMS is used by customers and partners."
              />
              <GroupItem href="/customers" title="Enterprise Case Studies" />
              <GroupItem href="/customer-stories" title="Casual Customer Chats" />
              <GroupItem href="/wall" title="Our Wall of Love" />
            </Group>
            <div class={s.quoteWrapper}>
              <div class={s.quote}>
                <blockquote>
                  <p>
                    DatoCMS has become an indispensable tool for us. Fast, flexible, and a pleasure
                    to use.
                  </p>
                  <footer>
                    <div class={s.quoteAvatar}>
                      <img
                        loading="lazy"
                        src={'https://www.datocms-assets.com/205/1712274924-img_4983.jpg?auto=format&crop=faces&fit=crop&h=300&w=300'}
                      />
                    </div>
                    <cite>
                      <div class={s.name}>Tim Chesney</div>
                      <div class={s.role}>Director at Make</div>
                    </cite>
                  </footer>
                </blockquote>
              </div>
            </div>
          </PanelHighlight>
          <PanelSlice columns={2}>
            <Group columns={2} title="Enterprise projects" link="/customers">
              <GroupItem
                href="/customers/polestar"
                title="Polestar"
                description="Serving content in 28 locales with 250+ editors across 35 custom roles."
                imageUrl="https://www.datocms-assets.com/205/1648568107-webimage-31a550ca-084b-46f8-ac8d9741a15c737c.jpeg?auto=format&w=800"
              />
              <GroupItem
                href="/customers/chillys"
                title="Chillyâ€™s"
                description="Unlocking 166%+ growth in annual revenue with 2M+ monthly users."
                imageUrl="https://www.datocms-assets.com/205/1582294156-cover-chillys.jpg?auto=format&w=800"
              />
              <GroupItem
                href="/customers/hashicorp"
                title="Hashicorp"
                description="Handling 2TB of traffic, with 5M+ monthly API calls on 35K+ records."
                imageUrl="https://www.datocms-assets.com/205/1581953189-1569253200-swilson-hc19.png?auto=format&w=800"
              />
              <GroupItem
                href="/customers/arduino"
                title="Arduino"
                description="Reducing lines of code by 92,5% while gaining 8x faster loading times."
                imageUrl="https://www.datocms-assets.com/205/1581958110-copy-of-arduino-teacher-students-978x653.jpeg?auto=format&w=800"
              />
            </Group>
          </PanelSlice>
        </NavItem>

        <NavItem name="Partners">
          <PanelHighlight>
            <Group title="DatoCMS â¤ï¸ Partners">
              <GroupItem
                href="/partners"
                title="Agency Partner Network"
                description="Some of our most successful customer projects come to life thanks to our incredible partners."
              />
              <GroupItem
                href="/tech-partners"
                title="Tech Partner Ecosystem"
                description="We work with the best APIs and tools in the space to make sure your projects stand out."
              />
            </Group>
            <div class={s.ctaBox}>
              <div class={s.ctaBoxShape}>
                <div class={s.ctaImageWrapper}>
                  <div class={s.ctaImage}>
                    <Svg name="svg/illustrations/faces-2" />
                  </div>
                </div>
                <article class={s.ctaBody}>
                  <h3 class={s.ctaTitle}>Join The Network</h3>
                  <p class={s.ctaDescription}>
                    Explore the benefits you unlock when you join our partner ecosystem.
                  </p>
                </article>
                <Button class={s.ctaButton} as="a" p="tiny" href="/partner-program">
                  Become a partner
                </Button>
              </div>
            </div>
          </PanelHighlight>
          <PanelSlice columns={2}>
            <Group columns={2} title="Partner projects" link="/partners/showcase">
              <GroupItem
                href="/partners/november-five/showcase/mdlbeast"
                title="MDLBeast by November Five"
                description="One of EMEA's largest entertainment companies uses blocks for a stellar UX."
                imageUrl="https://www.datocms-assets.com/205/1685971352-mdlbeast.jpg?auto=format&w=800"
              />
              <GroupItem
                href="/partners/fully-studios/showcase/toca-boca"
                title="Toca Boca by Fully Studios"
                description="Leading game developer gets a new website on Next.js and AWS."
                imageUrl="https://www.datocms-assets.com/205/1715249902-project_img.png?auto=format&w=800"
              />
              <GroupItem
                href="/partners/cantiere-creativo/showcase/l-officiel"
                title="Lâ€™Officiel by Cantiere Creativo"
                description="Global fashion magazine runs 30+ online magazines from a single CMS instance."
                imageUrl="https://www.datocms-assets.com/205/1640195611-home-page-fr.png?auto=format&w=800"
              />
              <GroupItem
                href="/partners/rotate/showcase/wild"
                title="Wild by RotateÂ°"
                description="Subscription-first cosmetic brand gets a world-class content overhaul."
                imageUrl="https://www.datocms-assets.com/205/1718048731-1661957070-wild_02.jpg?auto=format&w=800"
              />
            </Group>
          </PanelSlice>
        </NavItem>

        <NavItem name="Developers">
          <PanelSlice columns={1}>
            <Group title="Documentation" link="/docs">
              <GroupItem
                href="/docs/content-delivery-api"
                title="GraphQL API Reference"
                description="Learn how to fetch your content into any frontend project."
              />
              <GroupItem
                href="/docs/content-management-api"
                title="Management API Reference"
                description="Handle creating, updating, deleting, and fetching content of your projects via API."
              />
              <GroupItem
                href="/docs/asset-api/images"
                title="Assets API Reference"
                description="Get up to speed with managing & optimizing images and videos in DatoCMS."
              />
              <GroupItem
                href="/docs/content-modelling"
                title="Modelling Your Schema"
                description="Build your administrative area and define the structure of your content."
              />
            </Group>
          </PanelSlice>
          <PanelSlice columns={2}>
            <Group columns={2} title="Marketplace" link="/marketplace">
              <GroupItem
                href="/marketplace/starters"
                title="Official Starters"
                description="Boilerplate templates to get you from zero-to-live within minutes."
                isNew
              />
              <GroupItem
                href="/marketplace/hosting"
                title="Hosting & Builds"
                description="Server, serverless, or static - we've got you and your stack covered."
              />
              <GroupItem
                href="/marketplace/plugins"
                title="Plugins"
                description="From web previews to SEO, easily expand DatoCMSâ€™s capabilities."
              />
              <GroupItem
                href="/marketplace/enterprise"
                title="Enterprise Apps"
                description="Keep your CMS secure with SSO, custom assets, and more."
              />
            </Group>
            <Group columns={2} title="Community & support">
              <GroupItem
                href="https://community.datocms.com"
                title="Community Forum"
                description="Get support, request a feature, or see what weâ€™re working on."
              />
              <GroupItem
                href="/slack"
                title="Slack Channel"
                description="Connect with 3K+ other developers using DatoCMS in production."
              />
            </Group>
          </PanelSlice>

          <PanelHighlight orientation="horizontal">
            <Group columns={3} title="Popular integrations">
              <div class={s.integrations}>
                <a href="/docs/next-js" class={s.integrationsItem}>
                  <Svg name="svg/logos/next-squared" class={s.integrationsImage} />
                  <p class={s.techName}>Next.js</p>
                </a>

                <a href="/docs/svelte" class={s.integrationsItem}>
                  <Svg name="svg/logos/svelte-squared" class={s.integrationsImage} />
                  <p class={s.techName}>SvelteKit</p>
                </a>

                <a href="/docs/astro" class={s.integrationsItem}>
                  <Svg name="svg/logos/astro-squared" class={s.integrationsImage} />
                  <p class={s.techName}>Astro</p>
                </a>

                <a href="/docs/nuxt" class={s.integrationsItem}>
                  <Svg name="svg/logos/nuxt-squared" class={s.integrationsImage} />
                  <p class={s.techName}>Nuxt</p>
                </a>
              </div>
            </Group>
          </PanelHighlight>
        </NavItem>

        <NavItem name="Resources">
          <PanelHighlight>
            <Group title="Core resources">
              <GroupItem
                href="/docs"
                title="Docs"
                description="API reference, integrations, and guides to work with DatoCMS."
              />
              <GroupItem
                href="/how-to-datocms"
                title="How to DatoCMS"
                description="User guides, comparisons, concepts, and so much more!"
              />
            </Group>
            <Group title="Blog" link="/blog">
              <GroupItem
                href="/blog/how-to-build-a-multi-language-website-with-next-js-i18n"
                title="Multilingual site with Next.js"
                description="Letâ€™s build a localized Next.js and GraphQL website with DatoCMS."
              />
              <GroupItem
                href="/blog/introducing-datocms-cache-tags"
                title="Introducing Cache Tags"
                description="No more costly and inefficient time-based invalidation methods."
              />
            </Group>
          </PanelHighlight>
          <PanelSlice columns={2}>
            <Group columns={2} title="User guides" link="/user-guides">
              <GroupItem
                href="/user-guides/content-management/deep-dive-into-structured-text-in-datocms"
                title="Deep Dive into Structured Text"
                description="All the magic of the Structured Text field and why editors LOVE it."
                imageUrl="https://image.mux.com/Yc4esLEsoQszLQLgkOKPCmVLARxnrMzV/thumbnail.jpg?width=918"
              />
              <GroupItem
                href="/user-guides/content-management/building-pages-and-deep-dive-into-modular-content"
                title="Building Pages with Modular Content"
                description="A WYSIWYG drag-and-drop experience? In headless? Madness!"
                imageUrl="https://image.mux.com/W5jgwKq95fqBS7kmfolmRJHrUx4jtEex/thumbnail.jpg?width=918"
              />
              <GroupItem
                href="/user-guides/media-management/videos-and-video-optimizations"
                title="Videos and Video Optimizations"
                description="Serve crunchy, crispy, 4K videos to any device in any format, with subs."
                imageUrl="https://image.mux.com/P1SA01aSHtY1jzHrASAu00jdfIH5OWF01Ih/thumbnail.jpg?width=918"
              />
              <GroupItem
                href="/user-guides/the-basics/intro-to-the-schema-builder"
                title="Intro to the Schema Builder"
                description="Master how to set up the foundations of your project's schema successfully."
                imageUrl="https://image.mux.com/ZXrCcv53t00n02f5yS500siKW102xdfJqG025/thumbnail.jpg?width=918"
              />
            </Group>
          </PanelSlice>
        </NavItem>

        <a href="/pricing" class={s.navLink}>
          <span>Pricing</span>
        </a>
      </div>

      <div class={s.navActions}>
        <a href="/contact" class={s.navLink}>Contact sales</a>
        <!-- TODO: conditional -->
        <div class={s.authActions} data-signed-in="true">
          <Button as="a" p="small" href="https://dashboard.datocms.com/">Enter dashboard</Button>
        </div>
        <div class={s.authActions} data-signed-in="false">
          <a href="https://dashboard.datocms.com/login" class={s.navLink} data-exclude-mobile>
            <span>Log in</span>
          </a>
          <Button as="a" p="small" href="https://dashboard.datocms.com/">Get started</Button>
        </div>
      </div>
    </nav>
  </div>
</site-navbar>

<script>
  import { WebComponent } from '~/lib/WebComponent';
  import { getCookie } from '~/lib/cookies';

  window.customElements.define(
    'site-navbar',
    class SiteNavbar extends WebComponent {
      signedInEl!: HTMLElement;
      notSignedInEl!: HTMLElement;

      parsedCallback() {
        this.handleAuth();
        this.handleNavItems();
      }

      handleAuth() {
        this.signedInEl = this.$('[data-signed-in=true]');
        this.notSignedInEl = this.$('[data-signed-in=false]');

        const isSignedIn = getCookie('datoAccountEmail');

        (isSignedIn ? this.signedInEl : this.notSignedInEl).style.display = 'contents';
        (isSignedIn ? this.notSignedInEl : this.signedInEl).remove();
      }

      handleNavItems() {
        const root = this.children[0] as HTMLElement;
        const targetTogglers = this.$$('[data-navbar-navitem] > target-toggler');

        this.on<CustomEvent<{ expanded: boolean }>>(
          root,
          'target-toggler:toggle',
          '[data-navbar-navitem] > target-toggler',
          (event, triggeredToggler) => {
            const togglerExpanded = event.detail.expanded;

            if (!togglerExpanded) {
              return;
            }

            for (const targetToggler of targetTogglers) {
              if (targetToggler !== triggeredToggler) {
                (targetToggler as any).toggle(false);
              }
            }

            const navItem = this.findClosestAncestor({
              startFrom: triggeredToggler,
              upTo: root,
              selector: '[data-navbar-navitem]',
            })!;

            navItem.scrollIntoView({ behavior: 'smooth' });
          },
        );
      }
    },
  );
</script>
